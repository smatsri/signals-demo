<main class="todo-page">
  <section class="todo-card">
    <header class="todo-header">
      <h1>{{ title }}</h1>
      <p>Track your tasks using Angular signals.</p>
    </header>

    @if (store.todosResource.isLoading()) {
    <p class="loading">Loading...</p>
    }

    @if (store.error(); as err) {
    <p class="error" role="alert">{{ err }}</p>
    }

    <form class="todo-input-row" (submit)="$event.preventDefault(); store.addTodo()" [class.disabled]="store.isBusy()">
      <input type="text" placeholder="What do you need to do?" [value]="store.newTodoText()"
        (input)="handleInputChange($event)" />
      <button type="submit">
        Add
      </button>
    </form>

    @if (!store.isBusy()) {
    <nav class="filter-bar" aria-label="Filter todos">
      <button type="button" [class.active]="store.currentFilter() === 'all'" (click)="store.setFilter('all')">
        All
      </button>
      <button type="button" [class.active]="store.currentFilter() === 'active'" (click)="store.setFilter('active')">
        Active
      </button>
      <button type="button" [class.active]="store.currentFilter() === 'completed'"
        (click)="store.setFilter('completed')">
        Completed
      </button>
    </nav>
    <section class="todo-list" *ngIf="store.filteredTodos().length; else emptyState">
      <ul>
        @for (todo of store.filteredTodos(); track todo.id) {
        <li [class.completed]="todo.completed">
          <label>
            <input type="checkbox" [checked]="todo.completed" (change)="store.toggleTodo(todo.id)" />
            <span>{{ todo.text }}</span>
          </label>
          <button type="button" class="remove-btn" (click)="store.removeTodo(todo.id)" aria-label="Remove todo">
            âœ•
          </button>
        </li>
        }
      </ul>
    </section>

    <ng-template #emptyState>
      <p class="empty">No todos yet. Add your first one!</p>
    </ng-template>

    <footer class="todo-footer" *ngIf="store.todos().length">
      <span>
        {{ store.remainingCount() }} {{ store.remainingCount() === 1 ? 'item' : 'items' }} left
      </span>
      <button type="button" class="clear-btn" (click)="store.clearCompleted()">
        Clear completed
      </button>
    </footer>
    }
  </section>
</main>